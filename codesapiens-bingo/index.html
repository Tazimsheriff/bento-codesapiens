<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CodeSapiens Bingo â€“ Gamified Networking</title>
  <meta name="description"
    content="A gamified networking accelerator for tech events. Scan QR codes, complete bingo challenges, and build your real network." />
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¯</text></svg>" />
  <link rel="stylesheet" href="/src/style.css" />
</head>

<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loading-screen">
    <div class="spinner"></div>
    <p style="color: var(--text-muted); font-size: 0.85rem;">Loading...</p>
  </div>

  <!-- Hero -->
  <main class="hero" id="main-content" style="display:none;">
    <div class="hero-logo">ğŸ¯</div>
    <div class="hero-tag">âš¡ CodeSapiens Â· Event 2026</div>
    <h1 class="hero-title">Networking<br />Bingo</h1>
    <p class="hero-subtitle">
      Scan. Connect. Conquer. Build your real tech network through gamified challenges at the event.
    </p>

    <!-- Login Form -->
    <div class="hero-form fade-in-up">
      <h2 id="auth-title">Join the Game</h2>
      <p id="auth-desc">Create your account to start playing.</p>
      <div class="form-stack">
        <div class="input-group">
          <label for="email-input">Email Address</label>
          <input type="email" id="email-input" placeholder="you@example.com" autocomplete="email" />
        </div>
        <div class="input-group">
          <label for="password-input">Password</label>
          <input type="password" id="password-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />
        </div>
        <button class="btn btn-primary btn-lg" id="login-btn" style="width:100%;">
          <span id="login-btn-text">Sign Up Now ğŸš€</span>
          <div class="spinner" id="login-spinner" style="display:none; width:18px; height:18px; border-width:2px;">
          </div>
        </button>

        <p style="text-align:center; font-size:0.85rem; color:var(--text-muted); margin-top:12px;">
          <span id="toggle-text">Already have an account?</span>
          <a href="#" id="auth-toggle" style="color:var(--accent-green); font-weight:600; text-decoration:none;">Sign
            In</a>
        </p>

        <div id="login-success"
          style="display:none; text-align:center; padding:12px; background:rgba(0,255,136,0.08); border:1px solid rgba(0,255,136,0.3); border-radius:12px; color:var(--accent-green); font-size:0.9rem;">
          âœ… Account created! Redirecting...
        </div>
      </div>
    </div>

    <!-- ... rest of features same ... -->
    <div style="display:flex; gap:20px; margin-top:48px; flex-wrap:wrap; justify-content:center; max-width:600px;">
      <div style="text-align:center; flex:1; min-width:120px;">
        <div style="font-size:28px; margin-bottom:8px;">ğŸ“±</div>
        <div style="font-size:0.8rem; color:var(--text-secondary); font-weight:500;">Scan QR Codes</div>
      </div>
      <div style="text-align:center; flex:1; min-width:120px;">
        <div style="font-size:28px; margin-bottom:8px;">ğŸ®</div>
        <div style="font-size:0.8rem; color:var(--text-secondary); font-weight:500;">Play Bingo</div>
      </div>
      <div style="text-align:center; flex:1; min-width:120px;">
        <div style="font-size:28px; margin-bottom:8px;">ğŸ¤</div>
        <div style="font-size:0.8rem; color:var(--text-secondary); font-weight:500;">Build Network</div>
      </div>
      <div style="text-align:center; flex:1; min-width:120px;">
        <div style="font-size:28px; margin-bottom:8px;">ğŸ†</div>
        <div style="font-size:0.8rem; color:var(--text-secondary); font-weight:500;">Win Together</div>
      </div>
    </div>
  </main>

  <div class="toast-container"></div>

  <script type="module">
    import { getSession, getCurrentProfile, signUp, signIn } from '/src/auth.js'
    import { showToast } from '/src/utils.js'

    let isSignUpMode = true

    async function init() {
      const loadingScreen = document.getElementById('loading-screen')
      const mainContent = document.getElementById('main-content')

      // Check if already logged in
      const session = await getSession()
      if (session) {
        const profile = await getCurrentProfile()
        if (profile) {
          window.location.href = '/bingo.html'
          return
        } else {
          window.location.href = '/onboarding.html'
          return
        }
      }

      loadingScreen.style.display = 'none'
      mainContent.style.display = 'flex'
    }

    // Toggle auth mode
    document.getElementById('auth-toggle').addEventListener('click', (e) => {
      e.preventDefault()
      isSignUpMode = !isSignUpMode

      const title = document.getElementById('auth-title')
      const desc = document.getElementById('auth-desc')
      const btnText = document.getElementById('login-btn-text')
      const toggleLabel = document.getElementById('toggle-text')
      const toggleLink = document.getElementById('auth-toggle')

      if (isSignUpMode) {
        title.innerText = 'Join the Game'
        desc.innerText = 'Create your account to start playing.'
        btnText.innerText = 'Sign Up Now ğŸš€'
        toggleLabel.innerText = "Already have an account?"
        toggleLink.innerText = 'Sign In'
      } else {
        title.innerText = 'Welcome Back'
        desc.innerText = 'Sign in to continue your bingo progress.'
        btnText.innerText = 'Sign In ğŸ¯'
        toggleLabel.innerText = "Don't have an account?"
        toggleLink.innerText = 'Sign Up'
      }
    })

    // Auth handler
    document.getElementById('login-btn').addEventListener('click', async () => {
      const email = document.getElementById('email-input').value.trim()
      const password = document.getElementById('password-input').value.trim()

      if (!email || !password) {
        showToast('Please enter both email and password', 'error')
        return
      }

      if (isSignUpMode && password.length < 6) {
        showToast('Password must be at least 6 characters', 'error')
        return
      }

      const btn = document.getElementById('login-btn')
      const btnText = document.getElementById('login-btn-text')
      const spinner = document.getElementById('login-spinner')

      btn.disabled = true
      const originalBtnText = btnText.innerText
      btnText.style.display = 'none'
      spinner.style.display = 'block'

      try {
        let result
        if (isSignUpMode) {
          result = await signUp(email, password)
        } else {
          result = await signIn(email, password)
        }

        const { data, error } = result

        if (error) {
          showToast(error.message, 'error')
          btn.disabled = false
          btnText.innerText = originalBtnText
          btnText.style.display = 'block'
          spinner.style.display = 'none'
        } else {
          showToast(isSignUpMode ? 'Account created!' : 'Logged in successfully!', 'success')

          // Check for profile and redirect
          const profile = await getCurrentProfile()
          if (profile) {
            window.location.href = '/bingo.html'
          } else {
            window.location.href = '/onboarding.html'
          }
        }
      } catch (err) {
        showToast('An unexpected error occurred', 'error')
        btn.disabled = false
        btnText.style.display = 'block'
        spinner.style.display = 'none'
      }
    })

    // Allow Enter key
    document.getElementById('password-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') document.getElementById('login-btn').click()
    })

    init()
  </script>
</body>

</html>
